<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>Solarium CP App Documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
        <link rel="stylesheet" href="../styles/material.css">
    </head>
    <body>
          <script>
               // Blocking script to avoid flickering dark mode
               // Dark mode toggle button
               var useDark = window.matchMedia('(prefers-color-scheme: dark)');
               var darkModeState = useDark.matches;
               var $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               var $darkModeToggles = document.querySelectorAll('.dark-mode-switch');
               var darkModeStateLocal = localStorage.getItem('compodoc_darkmode-state');

               function checkToggle(check) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].checked = check;
                    }
               }

               function toggleDarkMode(state) {
                    if (window.localStorage) {
                         localStorage.setItem('compodoc_darkmode-state', state);
                    }

                    checkToggle(state);

                    const hasClass = document.body.classList.contains('dark');

                    if (state) {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.add('dark');
                         }
                         if (!hasClass) {
                              document.body.classList.add('dark');
                         }
                    } else {
                         for (var i = 0; i < $darkModeToggles.length; i++) {
                              $darkModeToggles[i].classList.remove('dark');
                         }
                         if (hasClass) {
                              document.body.classList.remove('dark');
                         }
                    }
               }

               useDark.addEventListener('change', function (evt) {
                    toggleDarkMode(evt.matches);
               });
               if (darkModeStateLocal) {
                    darkModeState = darkModeStateLocal === 'true';
               }
               toggleDarkMode(darkModeState);
          </script>

        <div class="navbar navbar-default navbar-fixed-top d-md-none p-0">
               <div class="d-flex">
                    <a href="../" class="navbar-brand">Solarium CP App Documentation</a>
                    <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
               </div>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="d-none d-md-block menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content interface">
                   <div class="content-data">













<ol class="breadcrumb">
  <li class="breadcrumb-item">Interfaces</li>
  <li class="breadcrumb-item"
  >
  UsePaginatedCommissionsResult</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/hooks/usePaginatedCommissions.ts</code>
        </p>


            <p class="comment">
                <h3>Description</h3>
            </p>
            <p class="comment">
                <p>Return type for usePaginatedCommissions hook</p>

            </p>


        <section data-compodoc="block-index">
            <h3 id="index">Index</h3>
            <table class="table table-sm table-bordered index-table">
                <tbody>
                    <tr>
                        <td class="col-md-4">
                            <h6><b>Properties</b></h6>
                        </td>
                    </tr>
                    <tr>
                        <td class="col-md-4">
                            <ul class="index-list">
                                <li>
                                        <a href="#error" 
>
                                            error
                                        </a>
                                </li>
                                <li>
                                        <a href="#items" 
>
                                            items
                                        </a>
                                </li>
                                <li>
                                        <a href="#loadNext" 
>
                                            loadNext
                                        </a>
                                </li>
                                <li>
                                        <a href="#refreshing" 
>
                                            refreshing
                                        </a>
                                </li>
                                <li>
                                        <a href="#reload" 
>
                                            reload
                                        </a>
                                </li>
                            </ul>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>



            <section data-compodoc="block-properties">
                <h3 id="inputs">Properties</h3>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="error"></a>
                                        <span class="name "><b>error</b>
                                            <a href="#error">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>error:     <code>string | null</code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>    <code>string | null</code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>Current error state</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="items"></a>
                                        <span class="name "><b>items</b>
                                            <a href="#items">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>items:         <code><a href="../interfaces/Commission.html" target="_self" >Commission[]</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="../interfaces/Commission.html" target="_self" >Commission[]</a></code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>Array of commissions from all loaded pages</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="loadNext"></a>
                                        <span class="name "><b>loadNext</b>
                                            <a href="#loadNext">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>loadNext:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/function" target="_blank" >function</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/function" target="_blank" >function</a></code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>Function to load next page - no-op if already loading or no more pages</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="refreshing"></a>
                                        <span class="name "><b>refreshing</b>
                                            <a href="#refreshing">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>refreshing:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>Whether currently refreshing (loading first page)</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <table class="table table-sm table-bordered">
                        <tbody>
                                <tr>
                                    <td class="col-md-4">
                                        <a name="reload"></a>
                                        <span class="name "><b>reload</b>
                                            <a href="#reload">
                                                <span class="icon ion-ios-link"></span>
                                            </a>
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="col-md-4">
                                        <code>reload:         <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/function" target="_blank" >function</a></code>
</code>
                                    </td>
                                </tr>


                                    <tr>
                                        <td class="col-md-4">
                                            <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/function" target="_blank" >function</a></code>

                                        </td>
                                    </tr>





                            <tr>
                                <td class="col-md-4">
                                    <div class="io-description"><p>Function to reload from beginning</p>
</div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
            </section>
    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { useEffect, useCallback, useMemo, useRef } from &#x27;react&#x27;;
import { useSelector, useDispatch } from &#x27;react-redux&#x27;;
import { commissionApi } from &#x27;../store/api/commissionApi&#x27;;
import {
  selectPaginatedCommissions,
  selectPaginationMeta,
  selectPaginationLoading,
  selectCanLoadMore,
} from &#x27;../store/selectors/commissionSelectors&#x27;;
import {
  startNextPageLoad,
  finishNextPageLoad,
  resetPagination,
} from &#x27;../store/slices/commissionSlice&#x27;;
import { useConnectivity } from &#x27;../contexts/ConnectivityContext&#x27;;
import type { Commission } from &#x27;../database/models/Commission&#x27;;

/**
 * Return type for usePaginatedCommissions hook
 */
export interface UsePaginatedCommissionsResult {
  /** Array of commissions from all loaded pages */
  items: Commission[];
  /** Function to load next page - no-op if already loading or no more pages */
  loadNext: () &#x3D;&gt; Promise&lt;void&gt;;
  /** Whether currently refreshing (loading first page) */
  refreshing: boolean;
  /** Current error state */
  error: string | null;
  /** Function to reload from beginning */
  reload: () &#x3D;&gt; Promise&lt;void&gt;;
}

/**
 * Configuration options for usePaginatedCommissions
 */
export interface UsePaginatedCommissionsOptions {
  /** Number of items per page (default: 25) */
  pageSize?: number;
  /** Whether to auto-reload when coming online (default: true) */
  autoReloadOnline?: boolean;
}

/**
 * Custom hook for paginated commission loading with infinite scroll support
 * Following the exact same pattern as usePaginatedCustomers
 *
 * @param options Configuration options
 * @returns UsePaginatedCommissionsResult with items, loadNext, refreshing, error, reload
 *
 * @example
 * &#x60;&#x60;&#x60;typescript
 * const { items, loadNext, refreshing, error, reload } &#x3D; usePaginatedCommissions({
 *   pageSize: 25,
 *   autoReloadOnline: true
 * });
 *
 * // Load more items
 * const handleLoadMore &#x3D; () &#x3D;&gt; {
 *   loadNext(); // No-op if already loading or no more pages
 * };
 *
 * // Reload from beginning
 * const handleRefresh &#x3D; () &#x3D;&gt; {
 *   reload();
 * };
 * &#x60;&#x60;&#x60;
 */
export function usePaginatedCommissions(
  options: UsePaginatedCommissionsOptions &#x3D; {}
): UsePaginatedCommissionsResult {
  const { pageSize &#x3D; 25, autoReloadOnline &#x3D; true } &#x3D; options;

  // Get connectivity state
  const { isOnline } &#x3D; useConnectivity();

  // Get pagination state from Redux store
  const commissions &#x3D; useSelector(selectPaginatedCommissions);
  const paginationMeta &#x3D; useSelector(selectPaginationMeta);
  const loadingState &#x3D; useSelector(selectPaginationLoading);
  const canLoadMore &#x3D; useSelector(selectCanLoadMore);

  // Redux dispatch
  const dispatch &#x3D; useDispatch();

  // Track which page to load next
  const nextPageRef &#x3D; useRef(1);

  // Calculate next page based on loaded pages
  const nextPage &#x3D; useMemo(() &#x3D;&gt; {
    const loadedPages &#x3D; paginationMeta.pagesLoaded;
    if (loadedPages.length &#x3D;&#x3D;&#x3D; 0) return 1;

    // Find the next page that hasn&#x27;t been loaded
    let page &#x3D; 1;
    while (loadedPages.includes(page)) {
      page++;
    }
    return page;
  }, [paginationMeta.pagesLoaded]);

  // RTK Query lazy hook for manual triggering
  const [
    triggerGetCommissions,
    { isLoading: queryLoading, error: queryError },
  ] &#x3D; commissionApi.useLazyGetCommissionsQuery();

  // AbortController ref for cleanup
  const abortControllerRef &#x3D; useRef&lt;AbortController | null&gt;(null);

  /**
   * Load next page of commissions
   * No-op if already loading or no more pages available
   * Resolves instantly when offline
   */
  const loadNext &#x3D; useCallback(async (): Promise&lt;void&gt; &#x3D;&gt; {
    // Guard: Check if we can load more
    if (!canLoadMore) {
      console.log(&#x27;🚫 loadNext: No more pages available&#x27;);
      return;
    }

    // Guard: Check if already loading
    if (loadingState.isAnyLoading) {
      console.log(&#x27;🚫 loadNext: Already loading&#x27;);
      return;
    }

    // Guard: Check if offline - resolve instantly as required
    if (!isOnline) {
      console.log(&#x27;📱 loadNext: Offline, resolving instantly&#x27;);
      return;
    }

    // Cancel any previous request
    if (abortControllerRef.current) {
      abortControllerRef.current.abort();
    }

    // Create new AbortController for this request
    abortControllerRef.current &#x3D; new AbortController();

    const currentPage &#x3D; nextPage;
    const offset &#x3D; (currentPage - 1) * pageSize;

    console.log(
      &#x60;💰 Loading page ${currentPage} (offset: ${offset}, limit: ${pageSize})&#x60;
    );

    // Start loading state
    dispatch(startNextPageLoad());

    try {
      const result &#x3D; await triggerGetCommissions(
        { offset, limit: pageSize },
        { signal: abortControllerRef.current.signal }
      ).unwrap();

      // Calculate total pages from result
      const totalPages &#x3D; Math.ceil((result.data?.total || 0) / pageSize);

      // Finish loading state - success
      dispatch(
        finishNextPageLoad({
          page: currentPage,
          totalPages,
          success: true,
        })
      );

      console.log(&#x60;✅ Page ${currentPage} loaded successfully&#x60;);
    } catch (error: any) {
      // Don&#x27;t treat abort as an error
      if (error.name &#x3D;&#x3D;&#x3D; &#x27;AbortError&#x27;) {
        console.log(&#x27;🚫 Request aborted&#x27;);
        return;
      }

      const errorMessage &#x3D;
        error.message || error.error || &#x27;Failed to load next page&#x27;;

      // Finish loading state - error
      dispatch(
        finishNextPageLoad({
          page: currentPage,
          totalPages: paginationMeta.totalPages,
          success: false,
          error: errorMessage,
        })
      );

      console.error(&#x60;❌ Page ${currentPage} failed:&#x60;, errorMessage);
      throw error; // Re-throw for caller to handle if needed
    } finally {
      // Clear abort controller
      abortControllerRef.current &#x3D; null;
    }
  }, [
    canLoadMore,
    loadingState.isAnyLoading,
    isOnline,
    nextPage,
    pageSize,
    dispatch,
    triggerGetCommissions,
    paginationMeta.totalPages,
  ]);

  /**
   * Reload commissions from the beginning
   * Resets pagination state and loads first page
   */
  const reload &#x3D; useCallback(async (): Promise&lt;void&gt; &#x3D;&gt; {
    console.log(&#x27;🔄 Reloading commissions from beginning&#x27;);

    // Cancel any in-flight request
    if (abortControllerRef.current) {
      abortControllerRef.current.abort();
    }

    // Reset pagination state
    dispatch(resetPagination());
    nextPageRef.current &#x3D; 1;

    // Load first page
    await loadNext();
  }, [dispatch, loadNext]);

  // Auto-reload when coming online if cache is empty
  const prevOnlineRef &#x3D; useRef(isOnline);
  useEffect(() &#x3D;&gt; {
    const wasOffline &#x3D; !prevOnlineRef.current;
    const isNowOnline &#x3D; isOnline;
    prevOnlineRef.current &#x3D; isOnline;

    if (
      wasOffline &amp;&amp;
      isNowOnline &amp;&amp;
      autoReloadOnline &amp;&amp;
      commissions.length &#x3D;&#x3D;&#x3D; 0
    ) {
      console.log(&#x27;🌐 Back online with empty cache, auto-reloading...&#x27;);
      reload();
    }
  }, [isOnline, autoReloadOnline, commissions.length, reload]);

  // Load initial page if no data and online
  useEffect(() &#x3D;&gt; {
    if (
      commissions.length &#x3D;&#x3D;&#x3D; 0 &amp;&amp;
      isOnline &amp;&amp;
      !loadingState.isAnyLoading &amp;&amp;
      paginationMeta.pagesLoaded.length &#x3D;&#x3D;&#x3D; 0
    ) {
      console.log(&#x27;🚀 Initial load - no data found, loading first page&#x27;);
      loadNext();
    }
  }, [
    commissions.length,
    isOnline,
    loadingState.isAnyLoading,
    paginationMeta.pagesLoaded.length,
    loadNext,
  ]);

  // Cleanup on unmount
  useEffect(() &#x3D;&gt; {
    return () &#x3D;&gt; {
      if (abortControllerRef.current) {
        console.log(&#x27;🧹 Component unmounting, aborting requests&#x27;);
        abortControllerRef.current.abort();
      }
    };
  }, []);

  // Determine current error state
  const currentError &#x3D; useMemo(() &#x3D;&gt; {
    if (paginationMeta.error) return paginationMeta.error;
    if (queryError) {
      if (typeof queryError &#x3D;&#x3D;&#x3D; &#x27;string&#x27;) return queryError;
      if (&#x27;message&#x27; in queryError) return queryError.message as string;
      if (&#x27;error&#x27; in queryError) return queryError.error as string;
      return &#x27;Failed to load commissions&#x27;;
    }
    return null;
  }, [paginationMeta.error, queryError]);

  return {
    items: commissions,
    loadNext,
    refreshing: loadingState.isLoading,
    error: currentError,
    reload,
  };
}

/**
 * Default export for convenience
 */
export default usePaginatedCommissions;
</code></pre>
    </div>
</div>








                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'interface';
            var COMPODOC_CURRENT_PAGE_URL = 'UsePaginatedCommissionsResult.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script>
               $darkModeToggleSwitchers = document.querySelectorAll('.dark-mode-switch input');
               checkToggle(darkModeState);
               if ($darkModeToggleSwitchers.length > 0) {
                    for (var i = 0; i < $darkModeToggleSwitchers.length; i++) {
                         $darkModeToggleSwitchers[i].addEventListener('change', function (event) {
                              darkModeState = !darkModeState;
                              toggleDarkMode(darkModeState);
                         });
                    }
               }
          </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
